<!doctype html><html><head><title>Digital Ocean | Music</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=copyright content><meta name=robots content="noindex"><link rel=icon type=image/png sizes=32x32 href=/music-docs/favicon.png><link rel=stylesheet type=text/css href=https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css><link rel=stylesheet type=text/css href="https://fonts.googleapis.com/css?family=Kanit:300,400,500,700"><link rel=stylesheet type=text/css href="https://fonts.googleapis.com/css?family=Roboto+Mono:300,400,500|Roboto:400,500,700&display=swap"><link rel=stylesheet type=text/css href=https://regiocast.github.io/music-docs/sass/main.cc5f494de8a98fffa0d47fbc42bfbd12eceb8e24c31aad15595370fcac946af7.css integrity="sha256-zF9JTeipj/+g1H+8Qr+9EuzrjiTDGq0VWVNw/KyUavc="></style></head><body><header><button class=menu aria-hidden=true></button>
<a class=logo href=/music-docs aria-label=Documentation></a></header><div class=search><input id=search type=text placeholder="Search Documentation..."></div><div class=sidebar><header><a class=logo href=/music-docs aria-label=Home>music</a></header><div class=menu aria-hidden=true><button class=close></button></div><nav><a href=/music-docs class=back><svg fill="currentcolor" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20 20" enable-background="new 0 0 20 20"><path fill-rule="evenodd" clip-rule="evenodd" d="M18 9H4.41L8.7 4.71C8.89 4.53 9 4.28 9 4c0-.55-.45-1-1-1C7.72 3 7.47 3.11 7.29 3.29l-6 6C1.11 9.47 1 9.72 1 10s.11.53.29.71l6 6C7.47 16.89 7.72 17 8 17c.55.0 1-.45 1-1 0-.28-.11-.53-.29-.71L4.41 11H18c.55.0 1-.45 1-1S18.55 9 18 9z"/></svg><span>Home</span></a><h1 class=section-header>Server</h1><ul><li class=category>Configuration</li><li class=sidebar-item><a href=/music-docs/server/configuration/https/>Certificates</a></li><li class=sidebar-item><a href=/music-docs/server/configuration/headers/>Headers</a></li><li class=sidebar-item><a href=/music-docs/server/configuration/logging/>Logging</a></li><li class=sidebar-item><a href=/music-docs/server/overview/>Overview</a></li><li class=category>Storage</li><li class=sidebar-item><a href=/music-docs/server/storage/database/>Database</a></li><li class=category>Deployment</li><li class="sidebar-item selected"><a href=/music-docs/server/deployment/digital_ocean/ class=selected>Digital Ocean</a></li></ul></nav></div><main class=body><section class=body-content><header><h1>Digital Ocean</h1></header><article class=content><p>The App Platform gives you the power to quickly and easily build, deploy, manage, and scale apps. It keeps your apps secure by default, i.e., Digital Ocean creates, manages, and renews the SSL certificates while protecting your apps from DDoS attacks.</p><p>You can deploy the source code directly from your GitHub repositories (support for GitLab and Bitbucket is coming soon). You can also enable ‘Autodeploy on Push,’ which automatically re-deploys the app each time you push to the branch containing the source code.</p><p>The App Platform is one of the few PaaS products built on a shared Kubernetes platform. Digital Ocean automatically analyzes your code, create containers, and run them on Kubernetes clusters. Since Digital Ocean embrace open, cloud-native standards, there’s little to no code customization needed to use the App Platform.</p><h2 id=project-setup>Project Setup</h2><p>Create a new App and select the <code>music</code> Repository. Set a name, region, and your deployment Branch.</p><p>On the next view set your Build Command to:</p><pre><code>go build github.com/REGIOCAST/music/cmd/music-server
</code></pre><p>The Run Command will be set by DO. You can leave the Port as is, and Run Music with the default Settings on Port 8080. When deploying on DO AppEngine the Domain will have an ACME-Cert provided by DO.</p><h3 id=environment-variables>Environment variables</h3><p>You should at least set the Storage environment variables. The Digital Ocean Storage <code>Spaces</code> is compatible to S3.</p><pre><code>MUSIC_S3_BUCKET
MUSIC_S3_ACCESS_KEY_ID
MUSIC_S3_SECRET_ACCESS_KEY
MUSIC_S3_REGION
</code></pre><h3 id=database>Database</h3><p>While testing, the built-in SQLite Database is fine. But in a production environment, we recommend using Postgres SQL.</p><p>In your Apps Dashboard select <code>Components</code> and <code>+ Create Component</code>. From the Dropdown select <code>Database</code>. Select a name and attach it to your Stack.</p><pre><code>MUSIC_DATABASE_DATASOURCE=postgres
MUSIC_DATABASE_DATASOURCE=${db.DATABASE_URL}
MUSIC_DATABASE_CONNECTIONS=11
</code></pre><p>On a node with 1 GB of RAM Digital Ocean allows up to 22 Connections. To prevent issues on Blue/Green deployments set this to half.</p><p>On a Node with 4 GB of RAM with a maximum of 97 Connections you can set this value to 45.</p><h3 id=healthcheck>Healthcheck</h3><p>In your AppDashboard on the Components, view click on Health Checks => <code>Edit</code>. Select <code>HTTP</code> and enter <code>/health</code> as Path.</p><p>That&rsquo;s it.</p><h2 id=staging-and-live-environments>Staging and Live environments</h2><p>Repeat the App Platform Setup for your live environment. In the <code>App Platform Settings</code> for your live environment change <code>Deploy Settings</code> to <code>Autodeploy code changes: disabled</code></p><ul><li>Auto deploy to Staging</li><li>Test your Staging Application</li><li>Deploy to Live</li></ul></article></section><aside class=toc><nav class=table-of-contents><header>On This Page</header><nav id=TableOfContents><ul><li><a href=#project-setup>Project Setup</a><ul><li><a href=#environment-variables>Environment variables</a></li><li><a href=#database>Database</a></li><li><a href=#healthcheck>Healthcheck</a></li></ul></li><li><a href=#staging-and-live-environments>Staging and Live environments</a></li></ul></nav></nav></aside></main><footer><section><h2>Questions?</h2><p>We are always happy to help with questions you might have. <a href="javascript:document.querySelector('#search').focus()">Search</a> our documentation or check out
answers to common questions.</p></section><section><p>Is there a mistake on this page? Please <a href=https://github.com/REGIOCAST/music-docs>let us know</a> or edit <a href=https://github.com/REGIOCAST/music-docs/blob/master/content/server/deployment/digital_ocean.md>this page</a>.</p></section></footer><div class=overlay aria-hidden=true></div><script>function toggle(el){if(el.classList.contains("open")){el.classList.remove("open");}else{el.classList.add("open");}};function toggleSidebar(e){toggle(document.querySelector(".sidebar"));toggle(document.querySelector(".overlay"));}
document.querySelector(".overlay").addEventListener("click",toggleSidebar);document.querySelector("body > header .menu").addEventListener("click",toggleSidebar);document.querySelector(".sidebar .close").addEventListener("click",toggleSidebar);</script><script type=text/javascript src=https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js></script><script type=text/javascript></script></body></html>